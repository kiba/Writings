#!/bin/bash

directories="for_science"

generateDir () {
  dir="reports/$1"
  if [ ! -d $dir ]; then
    echo "No such directory $dir exists. Mkdir $dir."
    mkdir "reports/$1"
  fi
}

generateReport () {
  total=$(wc -w $1/chp*.md | tail -1)
  echo $total > "reports/$1/$(date +%Y-%m-%d.md)"
}

averageChange () {
  reports=$(ls reports/$1/*.md)
  directory=$1
  size=0
  changes=0
  words=()
  for i in ${reports[@]}
  do
    count=$(tail -1 ${i[0]})
    set -- $count
    words+=($1)
    if (($size > 1))
    then
      ((changes+=words[$size] - words[($size - 1)]))
    fi
    ((size+=1))
  done
  ((average=($changes / ($size - 1))))
  echo Average Rate of Change for directory $directory: $average
}

todayChange (){
  today="reports/$1/$(date +%Y-%m-%d.md)"
  yesterday="reports/$1/$(date -v-1d +%Y-%m-%d).md"

  y_words=( $(tail -1 $yesterday) )
  t_words=( $(tail -1 $today) )
  echo todayChanged: $(($t_words - $y_words))
}

for d in ${directories[@]}
do
  generateDir $d
  generateReport $d
  averageChange $d
  todayChange $d
done

# reports=$(ls -tr reports/*.md)
#
# graph=""
# size=0
# total_changed=0
# words=[]
#
# for i in ${reports[@]}
# do
#   count=$(tail -1 ${i[0]})
#   set -- $count
#
#   words+=($1)
#
#   graph+=" "
#   graph+=$1
#
#   if (($size > 1))
#   then
#     changes=$((${words[$size]} - ${words[($size - 1)]}))
#     ((total_changed+=$changes))
#   fi
#   ((++size))
# done
#
# spark $graph
# echo Average Rate of Change: `expr $total_changed / $size`
# echo Today\'s changes: $changes
